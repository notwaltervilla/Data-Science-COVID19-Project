---
title: "air_quality_jonas"
author: "Jonas"
date: "10/20/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

```



```{r load data}

#Loading EPA Air Quality Data
df_airquality2020<- read.csv("./data/annual_aqi_by_county_2020.csv")
df_airquality2020

#Load NYTimes Data - using code from c06
url_counties <- "https://raw.githubusercontent.com/nytimes/covid-19-data/master/live/us-counties.csv"
filename_nyt <- "./data/nyt_counties.csv"

## Download the data locally
curl::curl_download(
        url_counties,
        destfile = filename_nyt
      )

## Loads the downloaded csv
df_covid <- read_csv(filename_nyt)
df_covid
```


```{r wrangling data}
names(df_covid)[2] <- "County"
names(df_covid)[3] <- "State"
df_covid_air <- inner_join(df_covid, df_airquality2020, by = c("County", "State"))
df_covid_air #This is the joined version of the COVID-19 and EPA data set

```

```{r}
df_pm25 <- read_csv("./data/pm25.csv")
df_pm25
```
  group_by(fips) %>% 
  summarize(mean_pm25 = mean(pm25)) %>% 

  mutate(fips = filter(
                        nchar(fips) == 4
                )
           paste("0", fips, sep = "")
  ) %>%
  
  arrange((fips))




```{r zdr-theme}
## NOTE: No need to edit; feel free to re-use this code!
theme_common <- function() {
  theme_minimal() %+replace%
  theme(
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    axis.title.x = element_text(margin = margin(4, 4, 4, 4), size = 16),
    axis.title.y = element_text(margin = margin(4, 4, 4, 4), size = 16, angle = 90),

    legend.title = element_text(size = 16),
    legend.text = element_text(size = 12),

    strip.text.x = element_text(size = 12),
    strip.text.y = element_text(size = 12),

    panel.grid.major = element_line(color = "grey90"),
    panel.grid.minor = element_line(color = "grey90"),

    aspect.ratio = 4 / 4,

    plot.margin = unit(c(t = +0, b = +0, r = +0, l = +0), "cm"),
    plot.title = element_text(size = 18),
    plot.title.position = "plot",
    plot.subtitle = element_text(size = 16),
    plot.caption = element_text(size = 12)
  )
}
```


```{r}
df_covid_air %>%
  filter(State == "Alabama")  %>%
  summarise(Air_Quality_Index = Median.AQI, Cases = cases, County = County) %>%
  ggplot() +
  geom_point(aes(Air_Quality_Index, Cases, color = County))
  
 # ggplot() +
 # geom_line(aes("Median.AQI", "confirmed_cases", color = County))


```



```{r}
df_covid_air %>%
  summarise(
    Air_Quality_Index = Median.AQI,
    Cases = cases,
    County = County,
    State = State) %>%
  ggplot() +
  geom_point(aes(Air_Quality_Index, Cases, color = State)) +
  scale_y_log10()
df_covid_air %>%
  summarise(
    Air_Quality_Index = Median.AQI,
    Deaths = deaths,
    County = County,
    State = State) %>%
  ggplot() +
  geom_point(aes(Air_Quality_Index, Deaths, color = State)) +
  geom_smooth(aes(Air_Quality_Index, Deaths), method = "lm") +
  scale_y_log10()
```





 
```{r}
df_covid_air %>%
  filter(State == "California") %>%
  summarise(
    Air_Quality_Index = Median.AQI,
    Cases = cases,
    County = County,
    State = State) %>%
  ggplot() +
  geom_point(aes(Air_Quality_Index, Cases, color = County)) +
  scale_y_log10()

df_covid_air %>%
  filter(State == "Florida") %>%
  summarise(
    Air_Quality_Index = Median.AQI,
    Deaths = deaths,
    County = County,
    State = State) %>%
  ggplot() +
  geom_point(aes(Air_Quality_Index, Deaths, color = County)) +
  scale_y_log10()
```

```{r}
theme_NY <- function() {
  theme_minimal() %+replace%
  theme(
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    axis.title.x = element_text(margin = margin(4, 4, 4, 4), size = 16),
    axis.title.y = element_text(margin = margin(4, 4, 4, 4), size = 16, angle = 90),

    legend.title = element_text(size = 16),
    legend.text = element_text(size = 12),

    strip.text.x = element_text(size = 12),
    strip.text.y = element_text(size = 12),

    panel.grid.major = element_line(color = "grey90"),
    panel.grid.minor = element_line(color = "grey90"),

    aspect.ratio = 1.2 / 2,

    plot.margin = unit(c(t = +0.2, b = +0, r = +0.2, l = +0), "cm"),
    plot.title = element_text(size = 18),
    plot.title.position = "plot",
    plot.subtitle = element_text(size = 16),
    plot.caption = element_text(size = 12),
    
  )
}
df_covid_air %>%
  filter(State == "New York") %>%
  summarise(
    Air_Quality_Index = Median.AQI,
    Cases = cases,
    County = County,
    State = State) %>%
  ggplot() +
  geom_point(aes(Air_Quality_Index, Cases)) +
  geom_smooth(aes(Air_Quality_Index, Cases), method = "lm") +
  scale_y_log10() +
  labs(
    x = "2020 Median Air Quality Index (AQI)",
    y = "Cases"
  ) +
  theme_NY() +
  ggtitle("Lack of correlation in NY AQI and Cases")

```








